<link rel="stylesheet" href="./style.css">
<link rel="stylesheet" href="./style.css">
<div id="app"></div>
<div id="app"></div>

<script>
const app = document.getElementById("app");
const API = "https://winzludo-backend-b0uk.onrender.com/api";

// ================= AUTH SCREEN =================
function goAuth() {
    app.innerHTML = `
        <div class="container">
            <h2>Winzludo Login</h2>
            <input id="email" type="email" placeholder="Email" />
            <input id="password" type="password" placeholder="Password" />

            <button onclick="loginUser()">Login</button>

            <p style="text-align:center;margin-top:10px;">New here?</p>
            <button class="back-btn" onclick="loadSignup()">Create Account</button>
        </div>
    `;
}

// ================= SIGNUP SCREEN =================
function loadSignup() {
    app.innerHTML = `
        <div class="container">
            <h2>Create Account</h2>

            <input id="name" placeholder="Full Name" />
            <input id="email" placeholder="Email" />
            <input id="password" type="password" placeholder="Password" />

            <button onclick="registerUser()">Signup</button>
            <button class="back-btn" onclick="goAuth()">Back</button>
        </div>
    `;
}

// ================= REGISTER USER =================
async function registerUser() {
    let name = document.getElementById("name").value;
    let email = document.getElementById("email").value;
    let password = document.getElementById("password").value;

    if (!name || !email || !password) return alert("Fill all fields");

    try {
        let res = await fetch(API + "/signup", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ name, email, password })
        });

        let data = await res.json();

        if (!res.ok) return alert(data.message || "Signup failed");

        alert("Signup Successful!");
        goAuth();
    } catch {
        alert("Network error");
    }
}

// ================= LOGIN USER =================
async function loginUser() {
    let email = document.getElementById("email").value;
    let password = document.getElementById("password").value;

    if (!email || !password) return alert("Enter email & password");

    try {
        let res = await fetch(API + "/login", {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify({ email, password })
        });

        let data = await res.json();

        if (!res.ok) return alert(data.message || "Invalid login");

        localStorage.setItem("token", data.token);
        localStorage.setItem("user", JSON.stringify(data.user));

        alert("Login successful!");
        goDashboard();
    } catch {
        alert("Network error");
    }
}

// Load login screen initially
goAuth();
</script>